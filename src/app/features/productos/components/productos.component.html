<div class="productos-container">
    <div class="go-back">
      <button mat-button color="primary" (click)="goToHome()">
        <mat-icon>arrow_back</mat-icon>
        Volver
      </button>
    </div>
    <div class="header">
        <h1 class="page-title">Gestión de Productos</h1>
        <button mat-raised-button color="primary" (click)="openCreateDialog()">
            <mat-icon>add</mat-icon>
            Nuevo ingreso
        </button>
    </div>

    <mat-card>
        <mat-card-content>
            <mat-form-field appearance="outline" class="search-field">
                <mat-label>Buscar productos</mat-label>
                <input matInput [(ngModel)]="searchTerm" placeholder="Nombre, categoría o proveedor">
                <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>

            <div class="table-container">
                <table mat-table [dataSource]="productos()" class="productos-table">
                    <ng-container matColumnDef="nombre">
                        <th mat-header-cell *matHeaderCellDef>Producto</th>
                        <td mat-cell *matCellDef="let producto">
                            <div class="producto-info">
                                <strong>{{ producto.name }}</strong>
                                <small>{{ producto.description }}</small>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="categoria">
                        <th mat-header-cell *matHeaderCellDef>Categoría</th>
                        <td mat-cell *matCellDef="let producto">{{ producto.category }}</td>
                    </ng-container>

                    <ng-container matColumnDef="precio">
                        <th mat-header-cell *matHeaderCellDef>Precio</th>
                        <td mat-cell *matCellDef="let producto">{{ producto.price | currency }}</td>
                    </ng-container>

                    <ng-container matColumnDef="stock">
                        <th mat-header-cell *matHeaderCellDef>Stock</th>
                        <td mat-cell *matCellDef="let producto">
                            <div class="stock-info">
                                <span class="stock-value">{{ producto.stock }}</span>
                                <small class="stock-min">(Mín: {{ producto.minimumStock }})</small>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="proveedor">
                        <th mat-header-cell *matHeaderCellDef>Proveedor</th>
                        <td mat-cell *matCellDef="let producto">{{ producto.supplierName }}</td>
                    </ng-container>

                    <ng-container matColumnDef="estado_stock">
                        <th mat-header-cell *matHeaderCellDef>Estado de Stock</th>
                        <td mat-cell *matCellDef="let producto">
                            @switch (getStockStatus(producto)) {
                            @case ('normal') {
                            <mat-chip class="status-chip normal">Normal</mat-chip>
                            }
                            @case ('bajo') {
                            <mat-chip class="status-chip bajo">Stock Bajo</mat-chip>
                            }
                            @case ('critico') {
                            <mat-chip class="status-chip critico">Crítico</mat-chip>
                            }
                        }
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="estado">
                        <th mat-header-cell *matHeaderCellDef>Estado de producto</th>
                        <td mat-cell *matCellDef="let producto">
                            @if (producto.active) {
                                <mat-chip class="status-chip activo">Activo</mat-chip>
                            } @else {
                                <mat-chip class="status-chip inactivo">Inactivo</mat-chip>
                            }
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="acciones">
                        <th mat-header-cell *matHeaderCellDef>Acciones</th>
                        <td mat-cell *matCellDef="let producto">
                            <button mat-icon-button color="primary" (click)="openEditDialog(producto)"
                                matTooltip="Editar">
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button mat-icon-button color="warn" (click)="deleteProducto(producto)"
                                matTooltip="Eliminar">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>

                @if (productos().length === 0) {
                <div class="no-data">
                    <mat-icon>inventory_2</mat-icon>
                    <p>No se encontraron productos</p>
                </div>
                }
            </div>
        </mat-card-content>
    </mat-card>
</div>